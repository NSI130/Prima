<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ucapan Firebase Modular v9+</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 480px; margin: 2rem auto; }
  input, textarea, button { width: 100%; margin: 8px 0; padding: 10px; font-size: 1rem; }
  #output, #status { margin-top: 1rem; min-height: 50px; background: #eee; padding: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h2>Ucapan Firebase v9+ Modular</h2>

<input id="nameInput" placeholder="Masukkan nama untuk cari ucapan" />
<button onclick="cariUcapan()">Cari Ucapan</button>
<div id="output"></div>

<hr>

<input id="senderName" placeholder="Nama pengirim" />
<textarea id="messageInput" placeholder="Tulis ucapanmu di sini..." rows="3"></textarea>
<input id="passkeyInput" type="password" placeholder="Passkey kirim" />
<button onclick="kirimUcapan()">Kirim Ucapan</button>
<div id="status"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  // Konfigurasi Firebase kamu
  const firebaseConfig = {
    apiKey: "AIzaSyBpiW2qQlf56no5nMsBptuyh3XqqvkdFu8",
    authDomain: "ucapan-prima.firebaseapp.com",
    databaseURL: "https://ucapan-prima-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "ucapan-prima",
    storageBucket: "ucapan-prima.firebasestorage.app",
    messagingSenderId: "937026282948",
    appId: "1:937026282948:web:b6283bafe96ebe15aaf091",
    measurementId: "G-89F170B22L"
  };

  // Inisialisasi Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const PASSKEY = "AraCintaNashri";

  async function cariUcapan() {
    const nama = document.getElementById('nameInput').value.trim().toLowerCase();
    const output = document.getElementById('output');
    if(!nama) {
      output.textContent = "Isi nama dulu ya!";
      return;
    }
    output.textContent = "Mencari ucapan...";
    try {
      const docRef = doc(db, "ucapan", nama);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        output.textContent = data.message;
      } else {
        output.textContent = `Maaf, ucapan untuk ${nama} belum tersedia.`;
      }
    } catch(e) {
      output.textContent = "Gagal mengambil data, coba lagi nanti.";
      console.error(e);
    }
  }

  async function kirimUcapan() {
    const senderName = document.getElementById('senderName').value.trim();
    const message = document.getElementById('messageInput').value.trim();
    const passkey = document.getElementById('passkeyInput').value.trim();
    const status = document.getElementById('status');

    if(!senderName || !message || !passkey) {
      status.textContent = "Semua kolom harus diisi.";
      status.style.color = "red";
      return;
    }
    if(passkey !== PASSKEY) {
      status.textContent = "Passkey salah!";
      status.style.color = "red";
      return;
    }

    status.textContent = "Mengirim ucapan...";
    status.style.color = "black";

    try {
      await setDoc(doc(db, "ucapan", senderName.toLowerCase()), {
        sender: senderName,
        message: message,
        timestamp: serverTimestamp()
      });
      status.textContent = "Ucapan berhasil dikirim! Terima kasih.";
      status.style.color = "green";

      // Reset form
      document.getElementById('senderName').value = "";
      document.getElementById('messageInput').value = "";
      document.getElementById('passkeyInput').value = "";
    } catch(e) {
      status.textContent = "Gagal mengirim ucapan, coba lagi nanti.";
      status.style.color = "red";
      console.error(e);
    }
  }
</script>

</body>
</html>
